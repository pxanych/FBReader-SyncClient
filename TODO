Идентификатор книги - хэш её содержимого.


О синхронизации:
синхронизироваться будем при запуске/завершении FBReader
	* можно синхронизироваться по запросу ОС, но так мы будем ошибаться в текущей позиции в книге

при синхронизации device-->server плагин будет посылать на сервер:
	- список добавленных/удалённых книг
	- список новых закладок + список удаляемых закладок
		*если FBReader будет сообщать о добавлении/удалении закладок - здесь всё просто,
		 в противном случае плагину придётся каждый раз отправлять на сервер все закладки на данном устройстве.
		 Есть ещё варианты, но они тоже не очень эффективные.
	- текущую позицию в книге
	- device_name, по которому сервер будет узнавать устройство и соответствующим образом обновлять свои таблицы
	- список изменённых настроек FBReader
	
при синхронизации server-->device сервер посылает следующие данные:
	- список закладок, которых пока ещё нет на данном устройстве, но которые можно добавить (с учётом наличия книг) 
	  (сервер составляет его на основе поля devices таблицы bookmarks и books)
	- список удаляемых закладок
	- текущую позицию в книге
	- список настроек FBReader
	

Т.к. при синхронизации идёт обмен только новыми данными, конфликтов возникать не должно.
Можно, конечно, запустить FBReader на двух устройствах одновременно и поменять одну и ту же настройку - 
в таком случае на сервере сохранится изменение, пришедшее последним. 

Если сеть недоступна на момент синхронизации - задача откладывается на некоторый срок,
все синхронизируемые данные при этом будут сохраняться плагином (таким образом отпадает необходимость в запущенном FBReader'е)

	
================================================================

Сервер:
	|Хранить данные пользователей в БД, а не в файлах
	|Сохранять закладки отдельно от настроек
	\___
		будем для каждого пользователя создавать таблицы:
			1) settings (group - string, name - string, value - string)
			2) bookmarks (book_hash - string, text_position - string, devices - string, deleted - bool)
			3) current_positions (device_name - string, book_hash - string, text_position - string)
			4) books (book_hash - string, device_name - string)
	
	Удалять закладки, которые удалил пользователь на одном из своих устройств:
		- как только устройство сообщает об удалении закладки - выставляем ей флаг deleted
		- остальным устройствам, у которых есть эта закладка, сервер будет сообщать, что её надо удалить
			*при следующей синхронизации устройство подтвердит удаление закладки -> убираем это устройство из поля devices
		- как только поле devices станет пустым - можно стирать запись о закладке на сервере
		? как плагин будет узнавать об удалении закладки? Кстати, о добавлении тоже надо как-то узнавать.
			- запрашивать у сервера полный список закладок и сравнивать с текущим списком закладок FBReader, но это долго.
			- получать информацию о добавлении/удалении закладок от самого FBReader			
			 
		
================================================================
	
Клиент.код:

----------------------------------------------------------------

Клиент.функционал:
	+При запуске FBReader загружаем обновления настроек/заладок с сервера, при завершении - скидываем всё на сервер
	+Как отследить запуск/завершение FBReader?
	Сделать меню, в котором можно было бы выбрать синхронизируемые настройки.

	Синхронизация закладок:
		? Отмечать книги, закладки которых нужно синхронизировать
		При синхронизации закладок передавать только diff данные	

----------------------------------------------------------------

Клиент.GUI:

	Исправить ошибку, из-за которой браузер не отображается в dialog'е.
	
	
================================================================

Методы API:
- X - информация, описывающая закладку.
1) List<X> Получение списка закладок для конкретной книги(Y);
2) List<Y> Получение списка книг();
3) String Путь к файлу книги(Y);
4) void Добавление закладок к книге(Y, List<X>);
5) void Удаление закладки(Y, X);
6) X получение текущего положения в книге();
- что можно использовать в качестве аргумента Y?
	Думаю, так или иначе, плагину придётся хранить таблицу соответствий (Y <==> хэш книги) на каждом устройстве


+ было бы здорово, если FBReader будет Broadcast'ить о своём запуске/завершении, 
  а также о добавлении/удалении закладок и книг, об изменении настроек.   
  

================================================================

NOTE:
**Разбить этот список на несколько групп, убрать лишнее.

Настройки, которые можно будет синхронизировать:
	Настройки папок пропускаем?
	Appearance
		Automatic rotation
		Show status bar (+show status bar when menu becomes active)
		Disable HW button
	Text
		Font:
			family, size, style ?
			More styles ...		?
		Line spacing
		Alignment
		Auto hyphenations
	Color & wallpapers
		Background
		BG color
		Search results BG
		Regular text
		Hyperlink text (+visited)
		Footer
		Selection BG
		Selected text
	Text margins (L, R, T, B)
	Progress indicator
		Scrollbar type
		Footer height
		Footer color
		Show TOC marks
		Show clock
		Show battery level
		Show page number
		Font family
	Display
		Screen brightness adjustment
		Prevent screen from sleeping
	Scrolling
		Touch screen scrolling
		Double tap detection
		Turn page with volume keys
		Invert volume keys direction
		Animation (Slide animation)
		Animation speed
		Horizontal scrolling
	Dictionary 
		Dictionary
		Translator
		Navigate over all words
		Long tapping action
	Images
		Long tapping action
		BG color for image
	Cancel menu
		Previous book
		Last 3 positions
		Back key action
		Back key long press action
		
		
================================================================

Приоритеты:
1) Server-side синхронизация настроек FBReader (таблицы + методы чтения/записи)
2) Client-side синхронизация настроек FBReader (меню выбора синхронизируемых настроек + методы общения с сервером)
	2.1) вынести всю работу по синхронизации в background часть плагина, GUI должен отвечать только за настройку плагина
3, 4) аналогично для закладок
